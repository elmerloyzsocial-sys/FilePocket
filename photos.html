<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Game Photos & Gallery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    .gallery-section { margin-bottom: 2em; }
    .gallery-title-row {
      display: flex;
      align-items: center;
      gap: 0.5em;
      flex-wrap: wrap;
    }
    .gallery-title-row input {
      font-size: 1.1em;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 0.2em 0.5em;
      margin-left: 0.5em;
      width: 60%;
    }
    .gallery { display: flex; flex-wrap: wrap; gap: 1em; justify-content: center; margin-top: 0.5em; }
    .gallery img { max-width: 180px; border-radius: 8px; box-shadow: 0 2px 8px #aaa; }
    .photo-caption { text-align: center; font-size: 0.95em; margin-top: 0.2em; color: #444; }
    .add-btn, .edit-btn {
      background: #ff9800;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.3em 1em;
      font-size: 0.95em;
      cursor: pointer;
      transition: background 0.2s;
      margin-left: 0.3em;
    }
    .add-btn:hover, .edit-btn:hover {
      background: #e65100;
    }
    .file-upload {
      margin: 0.5em 0;
    }
    .file-upload input[type="file"] {
      display: inline-block;
      margin-right: 0.5em;
    }
  </style>
</head>
<body>
  <header class="navbar">
    <h1>Game Photos & Gallery</h1>
    <button class="menu-toggle" onclick="toggleNav()">â˜°</button>
    <nav id="main-nav">
      <a href="index.html">Home</a>
      <a href="schedule.html">Schedule</a>
      <a href="stats.html">Stats</a>
      <a href="coaching.html">Coaching</a>
      <a href="plays.html">Plays</a>
      <a href="photos.html">Photos</a>
      <a href="events.html">Events</a>
      <a href="entertainment.html">Fun</a>
    </nav>
  </header>
  <main>
    <section class="card">
      <h2>Photo Galleries</h2>
      <button class="add-btn" onclick="openModal('gallery')">Add Gallery</button>
      <div id="galleries"></div>
    </section>
    <div id="modal" class="modal" style="display:none;">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <form id="addForm"></form>
      </div>
    </div>
  </main>
  <footer>
    <p>&copy; 2025 HoopStars Basketball Team</p>
  </footer>
  <script src="assets/js/main.js"></script>
  <script>
    // Get galleries from localStorage, else fallback to JSON file
    function getGalleries(callback) {
      let galleries = [];
      try {
        galleries = JSON.parse(localStorage.getItem('galleries') || '[]');
      } catch {}
      if (galleries.length) {
        callback(galleries);
      } else {
        fetch('data/photos.json').then(r=>r.json()).then(data=>{
          callback(data.galleries || []);
        });
      }
    }

    function renderGalleries() {
      getGalleries(function(galleries){
        const container = document.getElementById('galleries');
        container.innerHTML = '';
        galleries.forEach((gallery, idx) => {
          const section = document.createElement('div');
          section.className = 'gallery-section';

          // Editable title row
          const titleRow = document.createElement('div');
          titleRow.className = 'gallery-title-row';

          const title = document.createElement('span');
          title.textContent = gallery.title;
          title.className = 'gallery-title';

          // Editable input (hidden unless editing)
          const titleInput = document.createElement('input');
          titleInput.type = 'text';
          titleInput.value = gallery.title;
          titleInput.style.display = 'none';

          // Edit button
          const editBtn = document.createElement('button');
          editBtn.className = 'edit-btn';
          editBtn.textContent = 'Edit Title';
          editBtn.onclick = function() {
            title.style.display = 'none';
            titleInput.style.display = 'inline-block';
            titleInput.focus();
            editBtn.style.display = 'none';
            saveBtn.style.display = 'inline-block';
          };

          // Save button
          const saveBtn = document.createElement('button');
          saveBtn.className = 'edit-btn';
          saveBtn.textContent = 'Save';
          saveBtn.style.display = 'none';
          saveBtn.onclick = function() {
            gallery.title = titleInput.value;
            updateGallery(idx, gallery);
            renderGalleries();
          };

          // Add Photo button
          const addPhotoBtn = document.createElement('button');
          addPhotoBtn.className = 'add-btn';
          addPhotoBtn.textContent = 'Add Photo';
          addPhotoBtn.onclick = function() {
            openModal('photo', idx);
          };

          titleRow.appendChild(title);
          titleRow.appendChild(titleInput);
          titleRow.appendChild(editBtn);
          titleRow.appendChild(saveBtn);
          titleRow.appendChild(addPhotoBtn);

          section.appendChild(titleRow);

          // Gallery images
          const galleryDiv = document.createElement('div');
          galleryDiv.className = 'gallery';
          (gallery.photos || []).forEach(photo => {
            const photoDiv = document.createElement('div');
            const img = document.createElement('img');
            if (photo.data) {
              img.src = photo.data;
            } else if (photo.url) {
              img.src = photo.url;
            } else {
              img.alt = "No image";
            }
            img.alt = photo.caption;
            img.title = photo.caption;
            const caption = document.createElement('div');
            caption.className = 'photo-caption';
            caption.textContent = photo.caption;
            photoDiv.appendChild(img);
            photoDiv.appendChild(caption);
            galleryDiv.appendChild(photoDiv);
          });

          section.appendChild(galleryDiv);
          container.appendChild(section);
        });
      });
    }

    // Update gallery in localStorage
    function updateGallery(idx, gallery) {
      let galleries = [];
      try {
        galleries = JSON.parse(localStorage.getItem('galleries') || '[]');
      } catch {}
      galleries[idx] = gallery;
      localStorage.setItem('galleries', JSON.stringify(galleries));
    }

    // Add new gallery
    function addGallery(title) {
      let galleries = [];
      try {
        galleries = JSON.parse(localStorage.getItem('galleries') || '[]');
      } catch {}
      galleries.unshift({ title: title, photos: [] });
      localStorage.setItem('galleries', JSON.stringify(galleries));
      closeModal();
      renderGalleries();
    }

    // Add photo to gallery (Base64 support)
    function addPhotoToGallery(galleryIdx, data, caption) {
      let galleries = [];
      try {
        galleries = JSON.parse(localStorage.getItem('galleries') || '[]');
      } catch {}
      if (!galleries[galleryIdx]) return;
      galleries[galleryIdx].photos = galleries[galleryIdx].photos || [];
      galleries[galleryIdx].photos.unshift({ data, caption });
      localStorage.setItem('galleries', JSON.stringify(galleries));
      closeModal();
      renderGalleries();
    }

    // Modal open/close for gallery/photo
    function openModal(type, galleryIdx) {
      const modal = document.getElementById('modal');
      const form = document.getElementById('addForm');
      let html = '';
      if (type === 'gallery') {
        html = `
          <h3>Add Gallery</h3>
          <input type="text" id="galleryTitle" placeholder="Gallery Title" required><br>
          <button type="button" onclick="submitGallery()">Add Gallery</button>
        `;
      } else if (type === 'photo') {
        html = `
          <h3>Add Photo</h3>
          <div class="file-upload">
            <input type="file" id="photoFile" accept="image/*" required>
          </div>
          <input type="text" id="photoCaption" placeholder="Caption" required><br>
          <button type="button" onclick="submitPhoto(${galleryIdx})">Add Photo</button>
          <div id="photoPreview"></div>
        `;
      }
      form.innerHTML = html;
      modal.style.display = 'flex';

      // Attach file input handler if adding photo
      if (type === 'photo') {
        const fileInput = document.getElementById('photoFile');
        fileInput.addEventListener('change', function(e){
          previewPhoto(e.target.files[0]);
        });
      }
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    // Modal submit handlers
    function submitGallery() {
      const title = document.getElementById('galleryTitle').value;
      if (title.trim()) addGallery(title.trim());
    }

    function submitPhoto(galleryIdx) {
      const fileInput = document.getElementById('photoFile');
      const file = fileInput.files[0];
      const caption = document.getElementById('photoCaption').value;
      if (!file || !caption.trim()) return alert('Please select an image and enter a caption.');
      const reader = new FileReader();
      reader.onload = function(e) {
        const base64 = e.target.result;
        addPhotoToGallery(galleryIdx, base64, caption.trim());
      };
      reader.readAsDataURL(file);
    }

    // Image preview
    function previewPhoto(file) {
      if (!file) {
        document.getElementById('photoPreview').innerHTML = '';
        return;
      }
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('photoPreview').innerHTML =
          `<img src="${e.target.result}" style="max-width:120px;max-height:120px;border-radius:8px;margin-top:0.5em;">`;
      };
      reader.readAsDataURL(file);
    }

    renderGalleries();
  </script>
</body>
</html>